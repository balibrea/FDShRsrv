<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: "Lato", sans-serif;
        }

        /* Sidebar Styles */
        .sidebar {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: #111;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
        }

        .sidebar a {
            padding: 8px 8px 8px 32px;
            text-decoration: none;
            font-size: 25px;
            color: #818181;
            display: block;
            transition: 0.3s;
        }

        .sidebar a:hover {
            color: #f1f1f1;
        }

        .sidebar .closebtn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }

        .openbtn {
            font-size: 20px;
            cursor: pointer;
            background-color: #111;
            color: white;
            padding: 10px 15px;
            border: none;
        }

        .openbtn:hover {
            background-color: #444;
        }

        #main {
            transition: margin-left .5s;
            padding: 16px;
        }

        table,
        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        .green { background-color: green; color: white; }
        .red { background-color: red; color: black; }
        .yellow { background-color: yellow; color: black;}

        table {
            margin: 0 auto;
            width: auto;
        }

        th {
            background-color: lightblue;
        }

        td {
            max-width: 80px; /* Establece un ancho máximo */
            white-space: pre-wrap; /* Permite texto multilinea */
            word-wrap: break-word; /* Permite el ajuste de palabras largas */
            overflow: hidden; /* Oculta el desbordamiento */
            padding: 2px; /* Espaciado interno */
            text-overflow: ellipsis; /* Agrega puntos suspensivos si el texto es demasiado largo */
        }

        td:hover {
            background-color: lightyellow;
        }

        @media screen and (max-height: 450px) {
            .sidebar {
                padding-top: 15px;
            }

            .sidebar a {
                font-size: 18px;
            }
        }
    </style>
</head>

<body>

    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
        <h3 style="color: #818181; padding-left: 32px;">Shift Day</h3>

        <label for="tableSelect" style="color: #818181; padding-left: 32px;">Select Table:</label>
        <select id="tableSelect" style="margin-left: 32px;">
            <option value="1">Table 1</option>
            <option value="2">Table 2</option>
        </select><br><br>   

        <label for="rowSelect" style="color: #818181; padding-left: 32px;">FD building:</label>
        <select id="rowSelect" style="margin-left: 32px;"></select><br><br>

        <label for="colSelect" style="color: #818181; padding-left: 32px;">Shift Day:</label>
        <select id="colSelect" style="margin-left: 32px;"></select><br><br>

        <label for="cellText" style="color: #818181; padding-left: 32px;">Text:</label>
        <input type="text" id="cellText"><br><br>

        <label for="cellColor" style="color: #818181; padding-left: 32px;">Background Color:</label>
        
        <select id="cellColor" style="margin-left: 32px;">
            <option value="">Select color</option>
            <option value="red">Red</option>
            <option value="yellow">Yellow</option>
            <option value="green">Green</option>
        </select><br><br>

        <button onclick="editCell()" style="margin-left: 32px;">Edit Cell</button>
    </div>

    <div id="main">
        <button class="openbtn" onclick="toggleNav()">☰ Open/Close Sidebar</button>
        <h2 style="text-align: center;">FD Shifts Days Status</h2>

                
        {% for t in range(table_cnt) %}
        <p style="text-align: center;">Shift period from {{ dates[t] }}</p>

        <table id="shiftTable{{t+1}}" onclick="handleTableClick(event)">
            <colgroup>
                <col span="2" style="background-color: lightblue">
                <col span="3" style="background-color: green">
            </colgroup>

            <thead>
                <tr>
                    <th> </th>
                    {% if t < (table_cnt -1) %}
                        {% for col in days[t * MAX_COL : (t + 1) * MAX_COL] %}
                            <th>{{ col }}</th>
                        {% endfor %}

                    {% else %}
                        {% for col in days[t * MAX_COL : ] %}
                            <th>{{ col }}</th>
                        {% endfor %}

                    {% endif %}
                </tr>
            </thead>

            <tbody>
                {% for shift, statuses in data.items() %}
                <tr>
                    <td>{{ shift }}</td>
                    {% if t < 1 %}
                    {% for status in statuses[:MAX_COL] %}
                        <td class="{{ status[1] }}">{{ status[0] }}</td>
                    {% endfor %}
                    {% else %}
                    {% for status in statuses[MAX_COL:] %}
                        <td class="{{ status[1] }}">{{ status[0] }}</td>
                    {% endfor %}
                    {% endif%}
                </tr>
                {% endfor %}
            </tbody>
        
        </table>

        {% endfor %}

        
    </div>

    <script>
        let isOpen = false; // Track the sidebar state

        function toggleNav() {
            if (isOpen) {
                closeNav();
            } else {
                openNav();
            }
        }

        function openNav() {
            document.getElementById("mySidebar").style.width = "250px";
            document.getElementById("main").style.marginLeft = "250px";
            isOpen = true; // Update the state  
            populateRowAndColumnSelects(); // Populate the selects when opening  
        }

        function closeNav() {
            document.getElementById("mySidebar").style.width = "0";
            document.getElementById("main").style.marginLeft = "0";
            isOpen = false; // Update the state  
        }

        function populateRowAndColumnSelects() {
            const tableSelect = document.getElementById('tableSelect').value;
            const rowSelect = document.getElementById('rowSelect');
            const colSelect = document.getElementById('colSelect');

            // Clear previous options  
            rowSelect.innerHTML = "";
            colSelect.innerHTML = "";

            let rowNames = [];
            let colNames = [];

            if (tableSelect === "1") {
                rowNames = ["LL", "LM", "LA", "CO", "HE"];
                colNames = JSON.parse('{{ days|tojson|safe }}'); //["10-1", "11-1", "12-1", "13-1", "14-1", "15-1", "16-1", "17-1", "18-1"];
                console.log(colNames);
            } else if (tableSelect === "2") {
                rowNames = ["LL", "LM", "LA", "CO", "HE"];
                colNames = JSON.parse('{{ days|tojson|safe }}');//["19-1", "20-1", "21-1", "22-1", "23-1", "24-1", "25-1", "26-1", "27-1"];
            }

            // Populate row select  
            rowNames.forEach(rowName => {
                const option = document.createElement('option');
                option.value = rowName;
                option.text = rowName;
                rowSelect.appendChild(option);
            });

            // Populate column select  
            colNames.forEach(colName => {
                const option = document.createElement('option');
                option.value = colName;
                option.text = colName;
                colSelect.appendChild(option);
            });
        }

        function handleTableClick(event) {
            const cell = event.target;
            if (cell.tagName === 'TD') {
                const table = cell.closest('table');
                const tableId = table.id;
                const tableSelect = tableId === 'shiftTable1' ? '1' : '2';

                const rowName = table.rows[cell.parentNode.rowIndex].cells[0].innerText;
                const colName = table.rows[0].cells[cell.cellIndex].innerText;

                // Set the selected table 
                document.getElementById('tableSelect').value = tableSelect;
                populateRowAndColumnSelects();

                // Set the selected row and column 
                document.getElementById('rowSelect').value = rowName;
                document.getElementById('colSelect').value = colName;
            }
        }

        function editCell() {
            const tableSelect = document.getElementById('tableSelect').value;
            const rowName = document.getElementById('rowSelect').value;
            const colName = document.getElementById('colSelect').value;
            const text = document.getElementById('cellText').value;
            const color = document.getElementById('cellColor').value;

            let table = document.getElementById('shiftTable1');

            // Select the appropriate table based on user choice  
            if (tableSelect === "2") {
                table = document.getElementById('shiftTable2');
            }

            // Get row index from row name  
            const rowIndex = Array.from(table.rows).findIndex(row => row.cells[0].innerText === rowName);
            // Get column index from column name  
            const colIndex = Array.from(table.rows[0].cells).findIndex(cell => cell.innerText === colName);

            // Check if the row and column are valid  
            if (rowIndex > 0 && colIndex > 0) {
                const cell = table.rows[rowIndex].cells[colIndex];
                if (text) cell.innerText = text; // Update cell text  
                if (color) cell.style.backgroundColor = color; // Update cell background color 
                
                // Change text color to black if background is red or yellow  
                if (color === 'red' || color === 'yellow') {
                    cell.style.color = 'black'; // Set text color to black  
                } else {
                    // Optionally reset to default or another color if other backgrounds are used  
                    cell.style.color = ''; // Reset to default  
                }
            }
        }
    </script>

</body>

</html>